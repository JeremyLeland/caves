<!DOCTYPE HTML>
<html>
  <head>
    <title>Title</title>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <link rel="stylesheet" href="styles.css">
  </head>
  <body>
    <canvas id="canvas" width="320px" height="320px" style="float: left"></canvas>
    <div>
      R: <input type="range" min="0" max="255" oninput="sliderMoved()" id="redSlider"><br>
      G: <input type="range" min="0" max="255" oninput="sliderMoved()" id="greenSlider"><br>
      B: <input type="range" min="0" max="255" oninput="sliderMoved()" id="blueSlider"><br>
      <input type="text" id="colorText" onchange="textChanged()">
    </div>
    
    <script>
      function getColorizedImage(src, color) {
        const canvas = document.createElement('canvas');
        canvas.width = src.width;
        canvas.height = src.height;
        const ctx = canvas.getContext('2d');
        
        ctx.drawImage(src, 0, 0);
        
        // Apply color
        ctx.globalCompositeOperation = 'multiply';
        ctx.fillStyle = color;
        ctx.fillRect(0, 0, src.width, src.height);

        // Restore transparency
        ctx.globalCompositeOperation = 'destination-atop';
        ctx.drawImage(src, 0, 0);

        return canvas;
      }

      const image = new Image();
      image.onload = function() {
        updateColor();
      }
      image.src = './images/terrain/dirt.png';

      const canvas = document.getElementById('canvas');
      const ctx = canvas.getContext('2d');

      
      var color = 'white';
      const redSlider = document.getElementById('redSlider');
      const greenSlider = document.getElementById('greenSlider');
      const blueSlider = document.getElementById('blueSlider');
      const colorText = document.getElementById('colorText');

      function sliderMoved() {
        color = `rgb(${redSlider.value},${greenSlider.value},${blueSlider.value})`;
        colorText.value = color;
        updateColor();
      }

      function textChanged() {
        color = colorText.value;
        ctx.fillStyle = color;
        const str = ctx.fillStyle;

        redSlider.value   = parseInt(str.slice(1, 3), 16);
        greenSlider.value = parseInt(str.slice(3, 5), 16);
        blueSlider.value  = parseInt(str.slice(5, 7), 16);

        updateColor();
      }

      function updateColor() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        
        const colorized = getColorizedImage(image, color);
        
        ctx.drawImage(colorized, 0, 0);
      }
      
    </script>
  </body>
</html>
