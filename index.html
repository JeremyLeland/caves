<!DOCTYPE HTML>
<html>
  <head>
    <title>Title</title>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <link rel="stylesheet" href="styles.css">
  </head>
  <body>
    <canvas id="canvas" style="display: block"></canvas>
    
    <script type="module">
      import { TileMap } from '../src/TileMap.js';
      import { LevelGen } from '../src/LevelGen.js';
      import { GameCanvas, Keyboard, Mouse } from '../src/GameCanvas.js';

      const gameCanvas = new GameCanvas(document.getElementById('canvas'));
      const keyboard = new Keyboard();
      const mouse = new Mouse();

      window.onmousewheel = (e) => gameCanvas.scrollBy(e.deltaX, e.deltaY);

      const SCROLL_SPEED = 0.1;
      gameCanvas.update = (dt) => {
        if (keyboard.isPressed('ArrowLeft'))  gameCanvas.scrollBy(-SCROLL_SPEED * dt, 0);
        if (keyboard.isPressed('ArrowRight')) gameCanvas.scrollBy( SCROLL_SPEED * dt, 0);
        if (keyboard.isPressed('ArrowUp'))    gameCanvas.scrollBy(0, -SCROLL_SPEED * dt);
        if (keyboard.isPressed('ArrowDown'))  gameCanvas.scrollBy(0,  SCROLL_SPEED * dt);
      };

      const tileMap = new TileMap({cols: 30, rows: 30,
        tilesJson: [
          { src: '../images/terrain/dirt.png',  color: 'brown' },
          { src: '../images/terrain/grass.png', color: 'green' },
          { src: '../images/terrain/sand.png',  color: 'white' },
          { src: '../images/terrain/empty.png', color: 'white' },
        ],
        defaultIndex: 0
      });

      tileMap.ready.then(() => {
        const walls = LevelGen.generateCave(tileMap.cols + 1, tileMap.rows + 1);
        tileMap.setTileFromBoolArray(walls, tileMap.tiles[3]);

        gameCanvas.draw = (ctx) => tileMap.draw(ctx);
      });
      
    </script>
  </body>
</html>
