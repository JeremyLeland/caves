<!DOCTYPE HTML>
<html>
  <head>
    <title>Title</title>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <link rel="stylesheet" href="styles.css">
  </head>
  <body>
    <canvas id="canvas" style="display: block"></canvas>
    
    <script type="module">
      import { TileSet, TileMap } from '../src/TileMap.js';
      import { LevelGen } from '../src/LevelGen.js';

      const canvas = document.getElementById('canvas');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      const ctx = canvas.getContext('2d');

      let scrollX = 0, scrollY = 0;
      canvas.addEventListener('mousewheel', (e) => {
        scrollX += e.deltaX;
        scrollY += e.deltaY;
        redraw();
      });

      const KeyCode = { Left: 37, Up: 38, Right: 39, Down: 40 };
      const SCROLL_SPEED = 32;
      document.addEventListener('keydown', (e) => {
        switch (e.keyCode) {
          case KeyCode.Left:  scrollX -= SCROLL_SPEED; break;
          case KeyCode.Right: scrollX += SCROLL_SPEED; break;
          case KeyCode.Up:    scrollY -= SCROLL_SPEED; break;
          case KeyCode.Down:  scrollY += SCROLL_SPEED; break;
        }

        redraw();
      });

      


      const tileSet = new TileSet([
        { src: '../images/terrain/dirt.png',  color: 'brown' },
        { src: '../images/terrain/grass.png', color: 'green' },
        { src: '../images/terrain/sand.png',  color: 'white' },
        { src: '../images/terrain/empty.png', color: 'white' },
      ]);

      const COLS = 100, ROWS = 100;
      const tileMap = new TileMap(COLS, ROWS);

      tileSet.ready.then(() => {
        tileMap.fillWithTile(tileSet.tiles[0]);

        const walls = LevelGen.generateCave(COLS+1, ROWS+1);
        tileMap.setTileFromBoolArray(walls, tileSet.tiles[3]);

        redraw();
      });

      function redraw() {
        requestAnimationFrame(draw);
      }

      function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        ctx.save();
        ctx.translate(-scrollX, -scrollY);

        tileMap.draw(ctx);
        
        ctx.restore();
      }

      
      
    </script>
  </body>
</html>
