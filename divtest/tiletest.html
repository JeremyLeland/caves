<style>
  body { background-color: dimgray; margin: 0; }

.NW.NE.SW { background-position: -32 -0; }
.NW.NE.SE { background-position: -64 -0; }
.NW.SW.SE { background-position: -32 -32; }
.NE.SW.SE { background-position: -64 -32; }
.SE { background-position: -0 -64; }
.SW.SE { background-position: -32 -64; }
.SW { background-position: -64 -64; }
.NE.SE { background-position: -0 -96; }
.NW.NE.SW.SE { background-position: -32 -96; }
.NW.SW { background-position: -64 -96; }
.NE { background-position: -0 -128; }
.NW.NE { background-position: -32 -128; }
.NW { background-position: -64 -128; }
.var1 { background-position: -0 -160; }
.var2 { background-position: -32 -160; }
.var3 { background-position: -64 -160; }
.NE.SW { background-position: -0 -192; }
.NW.SE { background-position: -32 -192; }

.dirt { background-image: url("../images/terrain/dirt.png"); z-index: -9; }
.grass { background-image: url("../images/terrain/grass.png"); z-index: -2; }

/* Depends on all corners being present */
.corner_nw { left: -50%; top: -50%; }
.corner_ne { left:  50%; top: -50%; }
.corner_sw { left: -50%; top:  50%; }
.corner_se { left:  50%; top:  50%; }

.tile { background-image: inherit; position: absolute; width: inherit; height: inherit; overflow: hidden; }
.cell { position: relative; width: 32; height: 32; display: inline-block; }

.tilemap { 
  font-size: 0; /* get rid of gaps between inline divs */
  overflow: hidden;
}

</style>

<body>
</body>

<script>
  const TileSize = 32;

  const json = {
    "cols": 10, "rows": 10,
    "tileInfoKeys": [ "dirt", "grass", "snow" ],
    "tileMap": [
      0, 0, 0, 0, 0, 1, 1, 1, 1, 1,
      0, 1, 1, 1, 0, 1, 0, 0, 0, 1,
      0, 1, 0, 1, 0, 1, 2, 2, 0, 1,
      0, 1, 1, 1, 0, 1, 0, 0, 0, 1,
      0, 0, 0, 0, 0, 1, 1, 1, 1, 1,
      0, 1, 0, 1, 0, 0, 0, 0, 0, 0,
      0, 0, 1, 0, 0, 0, 1, 0, 0, 0,
      0, 1, 0, 1, 0, 1, 1, 1, 0, 0,
      0, 0, 0, 0, 0, 0, 1, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    ]
  };

  const cols = json.cols;
  const rows = json.rows;
  const tileMap = json.tileMap;

  const tileMapDiv = document.createElement( 'div' );
  tileMapDiv.className = 'tilemap';
  tileMapDiv.style.width = cols * TileSize;
  tileMapDiv.style.height = rows * TileSize;

  for ( let row = 0; row < rows; row ++ ) {
    for ( let col = 0; col < cols; col ++ ) {
      const cell = document.createElement( 'div' );

      // If we're out of bounds, use the closest in-bounds value
      const wCol = Math.max( 0, col - 1 ), eCol = Math.min( col + 1, cols - 1 );
      const nRow = Math.max( 0, row - 1 ), sRow = Math.min( row + 1, rows - 1 );

      const nw = tileMap[ wCol + nRow * cols ];
      const n  = tileMap[  col + nRow * cols ];
      const ne = tileMap[ eCol + nRow * cols ];
      const w  = tileMap[ wCol +  row * cols ];
      const us = tileMap[  col +  row * cols ];
      const e  = tileMap[ eCol +  row * cols ];
      const sw = tileMap[ wCol + sRow * cols ];
      const s  = tileMap[  col + sRow * cols ];
      const se = tileMap[ eCol + sRow * cols ];

      cell.className = `cell ${ json.tileInfoKeys[ us ] }`;

      const tileNW = document.createElement( 'div' );
      tileNW.classList.add( 'tile', 'corner_nw' );
      if ( nw == us )  tileNW.classList.add( 'NW' );
      if ( n  == us )  tileNW.classList.add( 'NE' );
      if ( w  == us )  tileNW.classList.add( 'SW' );
      tileNW.classList.add( 'SE' );
      cell.appendChild( tileNW );

      const tileNE = document.createElement( 'div' );
      tileNE.classList.add( 'tile', 'corner_ne' );
      if ( n  == us )  tileNE.classList.add( 'NW' );
      if ( ne == us )  tileNE.classList.add( 'NE' );
      tileNE.classList.add( 'SW' );
      if ( e  == us )  tileNE.classList.add( 'SE' );
      cell.appendChild( tileNE );

      const tileSW = document.createElement( 'div' );
      tileSW.classList.add( 'tile', 'corner_sw' );
      if ( w  == us )  tileSW.classList.add( 'NW' );
      tileSW.classList.add( 'NE' );
      if ( sw == us )  tileSW.classList.add( 'SW' );
      if ( s  == us )  tileSW.classList.add( 'SE' );
      cell.appendChild( tileSW );

      const tileSE = document.createElement( 'div' );
      tileSE.classList.add( 'tile', 'corner_se' );
      tileSE.classList.add( 'NW' );
      if ( e  == us )  tileSE.classList.add( 'NE' );
      if ( s  == us )  tileSE.classList.add( 'SW' );
      if ( se == us )  tileSE.classList.add( 'SE' );
      cell.appendChild( tileSE );

      tileMapDiv.appendChild( cell );
    }
  }

  document.body.appendChild( tileMapDiv );

</script>