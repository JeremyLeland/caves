<link rel="stylesheet" href="styles.css">
<body>
</body>

<script type="module">
  import { Level } from './level.js';

  const levelJson = {
    "ground": { 
      "cols": 10, "rows": 10, 
      "tileInfoKeys": [ "sand", "grass", "dirt", "water", "caveFloor" ], 
      "tileMap": [ 
        0, 1, 2, 2, 2, 2, 2, 3, 1, 1, 
        1, 2, 2, 2, 4, 4, 2, 3, 3, 2, 
        2, 2, 2, 4, 4, 4, 4, 3, 3, 2, 
        2, 2, 2, 4, 4, 4, 4, 3, 3, 2, 
        2, 2, 4, 4, 4, 4, 4, 4, 3, 3,
        2, 4, 4, 4, 4, 4, 0, 2, 2, 2, 
        2, 4, 4, 2, 4, 0, 0, 0, 2, 1, 
        2, 4, 4, 2, 4, 4, 0, 2, 2, 1, 
        2, 4, 4, 4, 4, 4, 2, 1, 1, 1, 
        2, 2, 4, 4, 2, 2, 2, 1, 1, 1 
      ] 
    }, 
    "props": { 
      "bush": [ 0, 2, 11, 20, 71, 73, 78 ], 
      "bridge_h": [ 27, 28 ], 
      "bridge_v": [ 49 ], 
      "tree2": [ 63 ] 
    }, 
    "actors": { 
      "skeleton": [ 16, 36 ], 
      "hero": [ 58 ], 
      "goblin": [ 66 ], 
      "spider": [ 88 ] 
    }
  }

  const level = new Level( levelJson );
  document.body.appendChild( level.tileMap.levelDiv );

  // let mouseX = 0, mouseY = 0;
  // document.onmousemove = ( e ) => {
  //   mouseX = e.pageX;
  //   mouseY = e.pageY;
  // };
  document.onmousedown = ( e ) => {
    const goalNode = level.tileMap.getNodeAt( e.pageX, e.pageY );
    level.teams[ 'player' ].forEach( player => {
      player.setGoalNode( goalNode )
      player.timers.wait = 0;
    } );
  };

  let lastTime = null;
  function animate( now ) {
    lastTime ??= now;   // for first call only
    level.update( now - lastTime );
    lastTime = now;

    requestAnimationFrame( animate );
  }
  requestAnimationFrame( animate );


</script>