<canvas id="canvas"></canvas>
<div id="ui">
  Action: <select id="actions"></select><br>
  Dir: <select id="dirs"></select>
</div>
    
<script type="module">
  import { Images } from '../src/Images.js';
  import { Sprite, Direction } from '../src/Sprite.js';
  import { Actor } from '../src/Actor.js';
  import { GameCanvas, Keyboard, Mouse } from '../src/GameCanvas.js';
  
  const gameCanvas = new GameCanvas(document.getElementById('canvas'), {fullscreen: false});

  const layerPaths = ['man', 'chest_male'].map(e => `../images/sprites/${e}.png`);

  const actions = ['cast', 'thrust', 'walk', 'slash', 'shoot', 'hurt'];
  
  const sprites = Array.from(layerPaths, (path) => 
    new Sprite({
      width: 64, height: 64, src: path, actions: actions,
    })
  );

  const actor = new Actor(sprites);

  const actionSelect = document.getElementById('actions');
  const dirSelect = document.getElementById('dirs');

  actionSelect.onchange = () => actor.action = actionSelect.value;
  dirSelect.onchange = () => actor.direction = Direction[dirSelect.value];

  fillSelectFromArray(actionSelect, actions);
  fillSelectFromArray(dirSelect, ['North', 'West', 'South', 'East']);

  actionSelect.onchange();
  dirSelect.onchange();

  Promise.all(sprites.map(s => s.ready)).then(() => {
    gameCanvas.update = (dt) => {
      actor.update(dt);
    }
    gameCanvas.draw = (ctx) => {
      actor.draw(ctx);
    }
  });

  function fillSelectFromArray(select, array) {
    array.forEach(item => {
      const option = document.createElement('option');
      option.innerText = item;
      select.appendChild(option);
    });
    select.value = array[0];
  }
  
</script>
