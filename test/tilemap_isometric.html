<link rel="stylesheet" href="../styles.css">
<script type="module">
  const tileMap = [
    [ 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0],
    [ 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0],
    [ 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0],
    [ 0, 0, 0, 1, 1, 0, 0, 1, 1, 1, 0, 0],
    [ 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0],
    [ 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [ 1, 0, 1, 0, 1, 0, 0, 1, 1, 1, 0, 0],
    [ 0, 0, 0, 1, 0, 0, 0, 1, 2, 1, 0, 0],
    [ 1, 0, 1, 0, 1, 0, 0, 1, 1, 1, 0, 0],
    [ 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [ 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [ 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0],
  ];

  
  const TILE_WIDTH = 64, TILE_HEIGHT = 32;

  const cols = tileMap.length, rows = tileMap[0].length;

  const canvas = document.createElement('canvas');
  canvas.width = rows * TILE_WIDTH;
  canvas.height = cols * TILE_HEIGHT;
  document.body.appendChild(canvas);

  const ctx = canvas.getContext('2d');

  const tileSheet = new Image();
  tileSheet.src = '../images/isometric/grassland_tiles.png';
  await tileSheet.decode();

  const tiles = [
    { col: 0, row:  0 }, 
    { col: 0, row: 19 },
    { col: 4, row: 20, rows: 2 },
  ];

  for (let row = 0; row < rows; row ++) {
    for (let col = 0; col < cols; col ++) {
      const tileIndex = tileMap[col][row];
      const tileInfo = tiles[tileIndex];

      const sx = tileInfo.col * TILE_WIDTH;
      const sy = tileInfo.row * TILE_HEIGHT;
      const w = (tileInfo.cols ?? 1) * TILE_WIDTH;
      const h = (tileInfo.rows ?? 1) * TILE_HEIGHT;

      const dx = (row + col) * TILE_WIDTH / 2;
      const dy = (rows - col + row - 1) * TILE_HEIGHT / 2;
      
      ctx.drawImage(tileSheet, sx, sy, w, h, dx, dy, w, h);
    }
  }
  
  function drawIsoTile(ctx, col, row, cols, rows, color) {
    const x = (row + col) * TILE_WIDTH / 2;
    const y = (rows - col + row - 1) * TILE_HEIGHT / 2;
    
    ctx.beginPath();
    ctx.moveTo(x                 , y + TILE_HEIGHT / 2);
    ctx.lineTo(x + TILE_WIDTH / 2, y                  );
    ctx.lineTo(x + TILE_WIDTH    , y + TILE_HEIGHT / 2);
    ctx.lineTo(x + TILE_WIDTH / 2, y + TILE_HEIGHT    );
    ctx.closePath();

    ctx.fillStyle = color;
    ctx.strokeStyle = 'gray';
    ctx.fill();
    ctx.stroke();
  }

</script>