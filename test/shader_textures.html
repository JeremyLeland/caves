<link rel="stylesheet" href="../styles.css">

<script type="module">
  import * as THREE from 'https://unpkg.com/three/build/three.module.js';
  import Stats from 'https://unpkg.com/three/examples/jsm/libs/stats.module.js';
  
  import { PerlinFunctions } from '../lib/Shaders.js';

  const scene = new THREE.Scene();
  scene.background = new THREE.Color( 0x222255 );

  const geometry = new THREE.BoxBufferGeometry();
  
  const material = new THREE.ShaderMaterial({
    // uniforms: {
    //   tiles:  { value: tiles },
    //   blends: { value: blends },
    // },
    vertexShader: `
      out vec2 v_uv;
      out vec4 v_pos;
      void main() {
        v_uv = uv;
        v_pos = modelViewMatrix * vec4(position, 1.0);

        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
      }
    `,
    fragmentShader: `
      ${ PerlinFunctions }

      in vec2 v_uv;
      in vec4 v_pos;

      out vec4 outColor;

      void main() {
        // Get the pattern value
        float percent = simplexNoise3(v_pos.xyz * 10.0);

        // percent is in the range [-1,+1]; map it to range [0,1]
        percent = (percent + 1.0) * 0.5;

        // Set the pixels color as a grayscale amount
        outColor = vec4(percent, percent, percent, 1.0);
        //outColor = v_pos;
      }
    `,
    glslVersion: THREE.GLSL3,
  });

  const mesh = new THREE.Mesh( geometry, material );
  scene.add( mesh );

  const light = new THREE.DirectionalLight( 0xffffff );
  light.position.set( 0, 1.0, 0.5 );
  light.target.position.set( 0, 0, 0 );
  scene.add( light );

  const camera = new THREE.PerspectiveCamera( 60, window.innerWidth / window.innerHeight, 0.1, 1000 );
  camera.position.set( 0, 0, 2 );
  camera.lookAt( 0, 0, 0 );

  const renderer = new THREE.WebGLRenderer();
  document.body.appendChild( renderer.domElement );

  const stats = new Stats();
  document.body.appendChild( stats.dom );

  window.onresize = () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();

    renderer.setSize( window.innerWidth, window.innerHeight );
  }
  window.onresize();

  animate();

  function animate() {
    requestAnimationFrame( animate );

    mesh.rotation.x += 0.005;
    mesh.rotation.y += 0.005;

    renderer.render( scene, camera );
    stats.update();
  }

</script>