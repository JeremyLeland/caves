<!DOCTYPE HTML>
<html>
  <head>
    <title>Drawing Tile Maps</title>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <link rel="stylesheet" href="../styles.css">
  </head>
  <body>
    <canvas id="canvas" width="1280px" height="640px" style="float: left"></canvas>
    
    <script type="module">
      import { TileMap } from '../src/TileMap.js';
      
      const json = {
        tiles: [
          { src: '../images/terrain/empty.png',  color: 'white' },
          { src: '../images/terrain/dirt.png',  color: 'brown' },
          { src: '../images/terrain/path.png', color: 'yellow' },
          { src: '../images/terrain/grass.png', color: 'green' },
          { src: '../images/terrain/sand.png',  color: 'white' }
        ],
        cols: 40,
        rows: 20,
        map: Array(21).fill(3).map(x => Array(41).fill(3))
      };

      const testCanvas = document.createElement('canvas');
      testCanvas.width = 41;
      testCanvas.height = 21;
      const testCtx = testCanvas.getContext('2d');

      // testCtx.fillStyle = 'rgb(1,0,0)';
      // testCtx.fillRect(3, 3, 5, 5);

      testCtx.strokeStyle = 'white';

      testCtx.beginPath();

      var points = [{x:0,y:2},{x:10,y:13},{x:20,y:8},{x:30,y:15},{x:40,y:20}]
      testCtx.moveTo((points[0].x), points[0].y);

      for(var i = 0; i < points.length-1; i ++)
      {
        var x_mid = (points[i].x + points[i+1].x) / 2;
        var y_mid = (points[i].y + points[i+1].y) / 2;
        var cp_x1 = (x_mid + points[i].x) / 2;
        var cp_x2 = (x_mid + points[i+1].x) / 2;
        testCtx.quadraticCurveTo(cp_x1,points[i].y ,x_mid, y_mid);
        testCtx.quadraticCurveTo(cp_x2,points[i+1].y ,points[i+1].x,points[i+1].y);
      }

      testCtx.stroke();

      // testCtx.beginPath();
      // testCtx.arc(13, 13, 5, 0, Math.PI * 2);
      // testCtx.stroke();

      const testData = testCtx.getImageData(0, 0, testCanvas.width, testCanvas.height);

      var i = 0;
      for (var row = 0; row <= json.rows; row ++) {
        for (var col = 0; col <= json.cols; col ++) {
          if (testData.data[i] > 0) {
            json.map[row][col] = 2;
          }
          i += 4;
        }
      }


      const tileMap = new TileMap(json);

      tileMap.ready.then(() => {

        // tileMap.setTileAt(10, 15, 0);
        // tileMap.setTileAt(20, 20, 1);

        // tileMap.addTileLine(1, 1, 4, 2, 2);
        // tileMap.addTileLine(10, 5, 2, 9, 1);

        // tileMap.addTileEllipse(10, 10, 5, 3, 1);
        // tileMap.addTileRectangle(12, 12, 2, 2, 4);

        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        ctx.clearRect(0, 0, canvas.width, canvas.height);
        tileMap.draw(ctx);
      });
      
    </script>
  </body>
</html>
