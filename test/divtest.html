<style>
  body { margin: 0; background-color: dimgray; }
  .prop { position: absolute; }
  .tree { background-image: url( ../images/trees.png ); }
  .tree1 { width: 96; height: 128; background-position: -128 -96; }

  .actor { position: absolute; }
  .goblin { 
    background-image: url( ../images/sprites/goblin/base.png );
    width: 65;
    height: 65;
  }
</style>
<div class="prop tree tree1" style="left: 32; top: 32; z-index: 2;"></div>
<div class="prop tree tree1" style="left: 64; top: 96; z-index: 3;"></div>

<script>

  const spriteInfo = {
    "width": 65, "height": 65,
    "centers": {
      "south": { x: 32, y: 50 },
      "east":  { x: 22, y: 54 },
      "north": { x: 32, y: 58 },
      "west":  { x: 42, y: 54 }
    },
    "imagesPath": "../images/sprites/goblin",
    "dirIndex": { "north": 2, "west": 3, "south": 0, "east": 1 },
    "actions": {
      "idle": { "col": 6, "row": 0, "frames": 1 },
      "walk": { "col": 0, "row": 0, "frames": 7, "loop": true },
      "thrust": { "col": 7, "row":  0, "frames":  4 },
      "slash":  { "col": 11, "row": 0, "frames":  6 },
      "die": { "col": 0, "row": 4, "frames": 5 }
    }
  };

  const goblin = createGoblin();
  document.body.appendChild( goblin.div );

  document.onmousemove = ( e ) => {
    goblin.angle = Math.atan2( e.pageY - goblin.y, e.pageX - goblin.x );
  };

  setInterval( () => {
    goblin.frame = ( goblin.frame + 1 ) % 7;
    updateSprite( goblin );
  }, 100 );

  function createGoblin() {
    const div = document.createElement( 'div' );
    div.setAttribute( 'class', 'actor goblin' );
    div.style.zIndex = 2;

    return {
      x: 32, y: 256, angle: Math.PI / 2, frame: 0,
      spriteInfo: spriteInfo,
      div: div
    };
  }

  function updateSprite( actor ) {
    const spriteInfo = actor.spriteInfo;

    const dir = directionFromAngle( actor.angle );

    const center = spriteInfo.centers ? spriteInfo.centers[ dir ] : spriteInfo.center;
    const x = actor.frame * spriteInfo.width;

    const dirIndex = spriteInfo.dirIndex[ dir ];
    const y = dirIndex * spriteInfo.height;

    const style = actor.div.style;
    style.left = actor.x - center.x;
    style.top = actor.y - center.y;
    style.backgroundPosition = `-${ x } -${ y }`;
  }

  function directionFromAngle( angle ) {
    if ( angle < ( -3 / 4 ) * Math.PI )   return 'west';
    if ( angle < ( -1 / 4 ) * Math.PI )   return 'north';
    if ( angle < (  1 / 4 ) * Math.PI )   return 'east';
    if ( angle < (  3 / 4 ) * Math.PI )   return 'south';

    return 'west';
  }

</script>