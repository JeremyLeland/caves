<link rel="stylesheet" href="../styles.css">

<script type="module">
  
  const SIZE = 128;

  const source = createSource( SIZE );
  const atlas = createAtlas( source );

  document.body.appendChild( source );

  function createSource( size ) {
    const canvas = document.createElement('canvas');
    canvas.width = size * 8;
    canvas.height = size * 2;
    const ctx = canvas.getContext( '2d' );

    const STOP_DIST = 0.3, STOP_1 = STOP_DIST, STOP_2 = 1 - STOP_DIST;

    let x, y, cx, cy, gradient;

    // one corner
    x = size * 0; y = 0;
    cx = x + size; cy = y + size;
    gradient = ctx.createRadialGradient( cx, cy, 0, cx, cy, size );
    gradient.addColorStop( STOP_1, 'white' );
    gradient.addColorStop( STOP_2, 'black' );
    ctx.fillStyle = gradient;
    ctx.fillRect( x, y, size * 2, size * 2 );

    // three corners
    x = size * 2; y = 0;
    cx = x + size; cy = y + size;
    gradient = ctx.createRadialGradient( cx, cy, 0, cx, cy, size );
    gradient.addColorStop( STOP_1, 'black' );
    gradient.addColorStop( STOP_2, 'white' );
    ctx.fillStyle = gradient;
    ctx.fillRect( x, y, size * 2, size * 2 );

    // two corners
    x = size * 4; y = 0;
    cx = x + size; cy = y;
    gradient = ctx.createRadialGradient( cx, cy, 0, cx, cy, size );
    gradient.addColorStop( STOP_1, 'white' );
    gradient.addColorStop( STOP_2, 'black' );
    ctx.fillStyle = gradient;
    ctx.fillRect( x, y, size, size );

    cx = x + size; cy = y + size * 2;
    gradient = ctx.createRadialGradient( cx, cy, 0, cx, cy, size );
    gradient.addColorStop( STOP_1, 'white' );
    gradient.addColorStop( STOP_2, 'black' );
    ctx.fillStyle = gradient;
    ctx.fillRect( x, y + size, size, size );

    cx = x; cy = y + size;
    gradient = ctx.createRadialGradient( cx, cy, 0, cx, cy, size );
    gradient.addColorStop( STOP_1, 'white' );
    gradient.addColorStop( STOP_2, 'black' );
    ctx.fillStyle = gradient;
    ctx.globalCompositeOperation = 'lighten';
    ctx.fillRect( x, y, size, size * 2 );
    ctx.globalCompositeOperation = 'source-over';
    
    // horizontal sides
    x = size * 5; y = 0;
    gradient = ctx.createLinearGradient( x, y, x, y + size * 2 );
    gradient.addColorStop( STOP_1 / 2, 'black' );
    gradient.addColorStop( STOP_2 / 2, 'white' );
    gradient.addColorStop( 1 - (STOP_2 / 2), 'white' );
    gradient.addColorStop( 1 - (STOP_1 / 2), 'black' );
    ctx.fillStyle = gradient;
    ctx.fillRect( x, y, size, size * 2 );

    // vertical sides
    x = size * 6; y = 0;
    gradient = ctx.createLinearGradient( x, y, x + size * 2, y );
    gradient.addColorStop( STOP_1 / 2, 'black' );
    gradient.addColorStop( STOP_2 / 2, 'white' );
    gradient.addColorStop( 1 - (STOP_2 / 2), 'white' );
    gradient.addColorStop( 1 - (STOP_1 / 2), 'black' );
    ctx.fillStyle = gradient;
    ctx.fillRect( x, y, size * 2, size );

    // solids
    x = size * 6, y = size;
    ctx.fillStyle = 'black';
    ctx.fillRect( x, y, size, size );
    ctx.fillStyle = 'white';
    ctx.fillRect( x + size, y, size, size );

    return canvas;
  }

  function createAtlas( source ) {
    const size = source.height / 2;

    const canvas = document.createElement('canvas');
    canvas.width = size;
    canvas.height = size * 2;
    const ctx = canvas.getContext( '2d' );

    let y = 0;

    // NW: 0, NE: 0, SW: 0, SE: 0
     
    // NW: 0, NE: 0, SW: 0, SE: 1
    // NW: 0, NE: 0, SW: 1, SE: 0
    // NW: 0, NE: 0, SW: 1, SE: 1
    // NW: 0, NE: 1, SW: 0, SE: 0
    // NW: 0, NE: 1, SW: 0, SE: 1
    // NW: 0, NE: 1, SW: 1, SE: 0
    // NW: 0, NE: 1, SW: 1, SE: 1
    // NW: 1, NE: 0, SW: 0, SE: 0
    // NW: 1, NE: 0, SW: 0, SE: 1
    // NW: 1, NE: 0, SW: 1, SE: 0
    // NW: 1, NE: 0, SW: 1, SE: 1
    // NW: 1, NE: 1, SW: 0, SE: 0
    // NW: 1, NE: 1, SW: 0, SE: 1
    // NW: 1, NE: 1, SW: 1, SE: 0
    // NW: 1, NE: 1, SW: 1, SE: 1
  }
  
  
</script>
