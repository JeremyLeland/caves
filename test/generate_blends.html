<link rel="stylesheet" href="../styles.css">

<script type="module">
  
  const SIZE = 64;

  const ONE_CORNER   = [ SIZE * 0, 0    ];
  const THREE_CORNER = [ SIZE * 2, 0    ];
  const TWO_CORNER   = [ SIZE * 4, 0    ];
  const HORIZONTAL   = [ SIZE * 5, 0    ];
  const VERTICAL     = [ SIZE * 6, 0    ];
  const SOLID        = [ SIZE * 6, SIZE ];
  
  function createSource() {
    const canvas = document.createElement('canvas');
    canvas.width = SIZE * 8;
    canvas.height = SIZE * 2;
    const ctx = canvas.getContext( '2d' );

    const STOP_DIST = 0.3, STOP_1 = STOP_DIST, STOP_2 = 1 - STOP_DIST;

    let x, y, cx, cy, gradient;

    // one corner
    [ x, y ] = ONE_CORNER;
    cx = x + SIZE; cy = y + SIZE;
    gradient = ctx.createRadialGradient( cx, cy, 0, cx, cy, SIZE );
    gradient.addColorStop( STOP_1, 'white' );
    gradient.addColorStop( STOP_2, 'black' );
    ctx.fillStyle = gradient;
    ctx.fillRect( x, y, SIZE * 2, SIZE * 2 );

    // three corners
    [ x, y ] = THREE_CORNER;
    cx = x + SIZE; cy = y + SIZE;
    gradient = ctx.createRadialGradient( cx, cy, 0, cx, cy, SIZE );
    gradient.addColorStop( STOP_1, 'black' );
    gradient.addColorStop( STOP_2, 'white' );
    ctx.fillStyle = gradient;
    ctx.fillRect( x, y, SIZE * 2, SIZE * 2 );

    // two corners
    [ x, y ] = TWO_CORNER;
    cx = x + SIZE; cy = y;
    gradient = ctx.createRadialGradient( cx, cy, 0, cx, cy, SIZE );
    gradient.addColorStop( STOP_1, 'white' );
    gradient.addColorStop( STOP_2, 'black' );
    ctx.fillStyle = gradient;
    ctx.fillRect( x, y, SIZE, SIZE );

    cx = x + SIZE; cy = y + SIZE * 2;
    gradient = ctx.createRadialGradient( cx, cy, 0, cx, cy, SIZE );
    gradient.addColorStop( STOP_1, 'white' );
    gradient.addColorStop( STOP_2, 'black' );
    ctx.fillStyle = gradient;
    ctx.fillRect( x, y + SIZE, SIZE, SIZE );

    cx = x; cy = y + SIZE;
    gradient = ctx.createRadialGradient( cx, cy, 0, cx, cy, SIZE );
    gradient.addColorStop( STOP_1, 'white' );
    gradient.addColorStop( STOP_2, 'black' );
    ctx.fillStyle = gradient;
    ctx.globalCompositeOperation = 'lighten';
    ctx.fillRect( x, y, SIZE, SIZE * 2 );
    ctx.globalCompositeOperation = 'source-over';
    
    // horizontal sides
    [ x, y ] = HORIZONTAL;
    gradient = ctx.createLinearGradient( x, y, x, y + SIZE * 2 );
    gradient.addColorStop( STOP_1 / 2, 'black' );
    gradient.addColorStop( STOP_2 / 2, 'white' );
    gradient.addColorStop( 1 - (STOP_2 / 2), 'white' );
    gradient.addColorStop( 1 - (STOP_1 / 2), 'black' );
    ctx.fillStyle = gradient;
    ctx.fillRect( x, y, SIZE, SIZE * 2 );

    // vertical sides
    [ x, y ] = VERTICAL;
    gradient = ctx.createLinearGradient( x, y, x + SIZE * 2, y );
    gradient.addColorStop( STOP_1 / 2, 'black' );
    gradient.addColorStop( STOP_2 / 2, 'white' );
    gradient.addColorStop( 1 - (STOP_2 / 2), 'white' );
    gradient.addColorStop( 1 - (STOP_1 / 2), 'black' );
    ctx.fillStyle = gradient;
    ctx.fillRect( x, y, SIZE * 2, SIZE );

    // solids
    [ x, y ] = SOLID;
    ctx.fillStyle = 'black';
    ctx.fillRect( x, y, SIZE, SIZE );
    ctx.fillStyle = 'white';
    ctx.fillRect( x + SIZE, y, SIZE, SIZE );

    return canvas;
  }

  function createAtlas( src ) {
    const canvas = document.createElement('canvas');
    canvas.width = SIZE;
    canvas.height = SIZE * 16;
    const ctx = canvas.getContext( '2d' );

    const coords = [
      // NW: 0, NE: 0, SW: 0, SE: 0
      [ SOLID[0], SOLID[1] ],
      
      // NW: 0, NE: 0, SW: 0, SE: 1
      [ ONE_CORNER[0], ONE_CORNER[1] ],

      // NW: 0, NE: 0, SW: 1, SE: 0
      [ ONE_CORNER[0] + SIZE, ONE_CORNER[1] ],

      // NW: 0, NE: 0, SW: 1, SE: 1
      [ HORIZONTAL[0], HORIZONTAL[1] ],

      // NW: 0, NE: 1, SW: 0, SE: 0
      [ ONE_CORNER[0], ONE_CORNER[1] + SIZE ],

      // NW: 0, NE: 1, SW: 0, SE: 1
      [ VERTICAL[0], VERTICAL[1] ],

      // NW: 0, NE: 1, SW: 1, SE: 0
      [ TWO_CORNER[0], TWO_CORNER[1] ],

      // NW: 0, NE: 1, SW: 1, SE: 1
      [ THREE_CORNER[0] + SIZE, THREE_CORNER[1] + SIZE ],

      // NW: 1, NE: 0, SW: 0, SE: 0
      [ ONE_CORNER[0] + SIZE, ONE_CORNER[1] + SIZE ],

      // NW: 1, NE: 0, SW: 0, SE: 1
      [ TWO_CORNER[0], TWO_CORNER[1] + SIZE ],

      // NW: 1, NE: 0, SW: 1, SE: 0
      [ VERTICAL[0] + SIZE, VERTICAL[1] ],

      // NW: 1, NE: 0, SW: 1, SE: 1
      [ THREE_CORNER[0], THREE_CORNER[1] + SIZE ],

      // NW: 1, NE: 1, SW: 0, SE: 0
      [ HORIZONTAL[0], HORIZONTAL[1] + SIZE ],

      // NW: 1, NE: 1, SW: 0, SE: 1
      [ THREE_CORNER[0] + SIZE, THREE_CORNER[1] ],

      // NW: 1, NE: 1, SW: 1, SE: 0
      [ THREE_CORNER[0], THREE_CORNER[1] ],

      // NW: 1, NE: 1, SW: 1, SE: 1
      [ SOLID[0] + SIZE, SOLID[1] ],
    ];

    let dx = 0, dy = 0;
    
    coords.forEach(cord => {
      ctx.drawImage( src, cord[0], cord[1], SIZE, SIZE, dx, dy, SIZE, SIZE );
      dy += SIZE;
    });
    
    return canvas;
  }

  const source = createSource();
  const atlas = createAtlas( source );

  document.body.appendChild( source );
  document.body.appendChild( document.createElement('br') );
  document.body.appendChild( atlas );
  
  
</script>
