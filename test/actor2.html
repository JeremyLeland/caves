<link rel="stylesheet" href="grid.css">

<style>
  div {
    position: absolute;
    overflow: hidden;
    background-attachment: local;
  }

  img {
    position: absolute;
  }

  .humanoid {
    width:  calc( 2 * 32px );
    height: calc( 2 * 32px );
    margin-left: -32px;
    margin-top:  -60px;
  }

  /* .humanoid > img {
    animation-name: humanoid_walk;
    animation-duration: 1s;
    animation-timing-function: steps( 7 );
    animation-iteration-count: infinite;
     animation-fill-mode: forwards;

    top: calc( ( -2 * 4 ) * 64px );
  }
  
  @keyframes humanoid_walk {
    from { left: calc( -1 * 64px ) }
    to   { left: calc( -8 * 64px ) }
  } */

  .player {
    background-image: 
      url( '../images/sprites/humanoid/male/hat.png' ), 
      url( '../images/sprites/humanoid/male/hair.png' ), 
      url( '../images/sprites/humanoid/male/belt.png' ), 
      url( '../images/sprites/humanoid/male/chest.png' ), 
      url( '../images/sprites/humanoid/male/pants.png' ),
      url( '../images/sprites/humanoid/male/shoes.png' ),
      url( '../images/sprites/humanoid/male/body.png' ),
      url( '../images/sprites/humanoid/male/shadow.png' )
  }

  .enemy {
    background-image:
      url( '../images/sprites/humanoid/male/skeleton.png' ),
      url( '../images/sprites/humanoid/male/shadow.png' )
  }

</style>

<div id="player" class="humanoid player" style="transform: translate( 128px, 128px )">
  <!-- <img src="../images/sprites/humanoid/male/shadow.png">
  <img src="../images/sprites/humanoid/male/body.png">
  <img src="../images/sprites/humanoid/male/shoes.png">
  <img src="../images/sprites/humanoid/male/pants.png">
  <img src="../images/sprites/humanoid/male/chest.png">
  <img src="../images/sprites/humanoid/male/belt.png">
  <img src="../images/sprites/humanoid/male/hair.png">
  <img src="../images/sprites/humanoid/male/hat.png"> -->
</div>
<div id="enemy"  class="humanoid enemy"  style="transform: translate( 192px, 128px )">
  <!-- <img src="../images/sprites/humanoid/male/shadow.png">
  <img src="../images/sprites/humanoid/male/skeleton.png"> -->
</div>

<script>

  const WIDTH = 64, HEIGHT = 64;
  const DIRS = 4;

  const actions = {
    idle:   { col: 0, row:  0 },
    cast:   { col: 1, row:  0, frames:  6, duration: 0.6 },
    thrust: { col: 1, row:  4, frames:  7, duration: 0.7 },
    walk:   { col: 1, row:  8, frames:  8, duration: 0.8, loop: true },
    slash:  { col: 1, row: 12, frames:  5, duration: 0.5 },
    shoot:  { col: 1, row: 16, frames: 12, duration: 1.2 },
    die:    { col: 1, row: 20, frames:  4, duration: 0.4, final: true },
  }

  let animation;

  function startAction( action ) {
    animation?.cancel();

    const steps = action.frames - 1;

    animation = player.animate( {
      backgroundPositionX: [
        `${ -WIDTH * action.col }px`, 
        `${ -WIDTH * ( action.col + steps ) }px` 
      ],

      // NOTE: Need to specify like this so that:
      //  1) It adds to existing background y
      //  2) It doesn't assume we're starting at 0
      backgroundPositionY: [
        `${ action.row * -HEIGHT }px`,
        `${ action.row * -HEIGHT }px`,
      ]
    }, {
      duration: action.duration * 1000,
      easing: `steps( ${ steps } )`,
      iterations: action.loop ? Infinity : 1,
      fill: action.final ? 'forwards' : 'none',
      composite: 'add',
    } );
  }

  const player = document.getElementById( 'player' );
  //player.scrollTop = 128;
  player.style.backgroundPositionY = `${ -2 * HEIGHT }px`;

  // player.animate( walkKeyframes, walkTiming );
  startAction( actions.walk );

</script>