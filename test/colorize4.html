<style>
</style>

<canvas id="canvas" style="float: left"></canvas>
<div style="float: left">
  <input id="picker" type="color" value="#00ff00"><br>
  <input id="brightness" type="range" min="0" max="100" value="50">
</div>

<script type="module">
  
  const image = new Image();
  image.src = '../images/sprites/human/male/hair.png';
  await image.decode();

  const canvas = document.getElementById('canvas');
  canvas.width = image.width;
  canvas.height = image.height;
  const ctx = canvas.getContext('2d');

  const picker = document.getElementById('picker');
  picker.oninput = updateColor;
  const brightness = document.getElementById('brightness');
  brightness.oninput = updateColor;
  updateColor();

  function updateColor() {
    ctx.clearRect(0, 0, image.width, image.height);
    
    ctx.save();

    ctx.drawImage(image, 0, 0);

    ctx.globalCompositeOperation = 'source-in';
    ctx.fillStyle = picker.value;
    ctx.fillRect(0, 0, image.width, image.height);
    
    ctx.globalCompositeOperation = 'luminosity';
    ctx.drawImage(image, 0, 0);

    const b = parseInt(brightness.value) / 100;
    ctx.globalAlpha = Math.abs(b * 2 - 1);
    ctx.fillStyle = b < 0.5 ? 'black' : 'white';
    ctx.globalCompositeOperation = 'source-atop';
    ctx.fillRect(0, 0, image.width, image.height);

    ctx.restore();
  }

</script>