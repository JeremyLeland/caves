<!DOCTYPE HTML>
<html>
  <head>
    <title>Colorize Images</title>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <link rel="stylesheet" href="../styles.css">
  </head>
  <body>
    <canvas id="canvas" width="600px" height="224px" style="float: left"></canvas>
    <table>
      <tr>
        <td>R:</td>
        <td><input type="range" min="0" max="255" id="redSlider"></td>
      </tr>
      <tr>
        <td>G:</td>
        <td><input type="range" min="0" max="255" id="greenSlider"></td>
      </tr>
      <tr>
        <td>B:</td>
        <td><input type="range" min="0" max="255" id="blueSlider"></td>
      </tr>
      <tr>
        <td colspan="2">
          <input type="text" id="colorText">
        </td>
      </tr>
    </table>
    <script type="module">
      import { ImageResource } from '../src/ImageResource.js';

      const canvas = document.getElementById('canvas');
      const ctx = canvas.getContext('2d');
      
      const redSlider = document.getElementById('redSlider');
      const greenSlider = document.getElementById('greenSlider');
      const blueSlider = document.getElementById('blueSlider');
      const colorText = document.getElementById('colorText');

      var color = 'white';
      colorText.value = color;

      redSlider.addEventListener('input', sliderMoved);
      greenSlider.addEventListener('input', sliderMoved);
      blueSlider.addEventListener('input', sliderMoved);
      colorText.addEventListener('change', textChanged);

      const images = [
        new ImageResource('../images/terrain/dirt.png'),
        new ImageResource('../images/terrain/sand.png'),
        new ImageResource('../images/terrain/path.png'),
        new ImageResource('../images/terrain/empty.png'),
        new ImageResource('../images/terrain/hole.png'),
        new ImageResource('../images/terrain/grass.png'),
      ];
      
      Promise.all(images.map(e => e.ready)).then(textChanged);

      function sliderMoved() {
        color = `rgb(${redSlider.value},${greenSlider.value},${blueSlider.value})`;
        colorText.value = color;
        updateColor();
      }

      function textChanged() {
        color = colorText.value;
        ctx.fillStyle = color;
        const str = ctx.fillStyle;

        redSlider.value   = parseInt(str.slice(1, 3), 16);
        greenSlider.value = parseInt(str.slice(3, 5), 16);
        blueSlider.value  = parseInt(str.slice(5, 7), 16);

        updateColor();
      }

      function updateColor() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        images.forEach((e, i) => ctx.drawImage(e.getColorizedImage(color), i * e.image.width, 0));
      }
      
    </script>
  </body>
</html>
